#![no_main]
sphinx_zkvm::entrypoint!(main);

extern "C" {
    fn syscall_bls12381_fp_add(p: *mut u32, q: *const u32);
}

pub fn main() {
    let a: [u8; 48] = [
        228, 106, 72, 120, 77, 201, 20, 66, 102, 164, 169, 130, 27, 165, 141, 9, 68, 102, 5, 170,
        209, 70, 36, 126, 113, 18, 24, 91, 5, 80, 169, 75, 130, 40, 70, 1, 62, 71, 120, 57, 209,
        104, 210, 238, 188, 198, 117, 7,
    ];
    let b: [u8; 48] = [
        96, 73, 110, 78, 155, 199, 140, 30, 164, 39, 135, 40, 82, 215, 126, 255, 139, 203, 67, 42,
        199, 165, 207, 109, 234, 238, 119, 155, 55, 29, 171, 109, 95, 128, 76, 12, 116, 155, 167,
        88, 28, 196, 19, 0, 90, 60, 100, 17,
    ];
    let add: [u8; 48] = [
        68, 180, 182, 198, 232, 144, 161, 96, 10, 204, 48, 171, 109, 124, 12, 9, 208, 49, 73, 212,
        152, 236, 243, 235, 91, 1, 144, 246, 60, 109, 84, 185, 225, 168, 146, 13, 178, 226, 31,
        146, 237, 44, 230, 238, 22, 3, 218, 24,
    ];

    let c: [u8; 48] = [
        229, 57, 243, 124, 79, 116, 73, 223, 1, 108, 152, 200, 103, 48, 255, 26, 190, 171, 136, 7,
        242, 26, 239, 193, 98, 206, 165, 35, 166, 14, 131, 67, 165, 197, 199, 115, 41, 95, 161,
        205, 101, 124, 51, 137, 203, 228, 72, 10,
    ];
    let double: [u8; 48] = [
        202, 115, 230, 249, 158, 232, 146, 190, 3, 216, 48, 145, 207, 96, 254, 53, 124, 87, 17, 15,
        228, 53, 222, 131, 197, 156, 75, 71, 76, 29, 6, 135, 74, 139, 143, 231, 82, 190, 66, 155,
        203, 248, 102, 18, 151, 201, 145, 20,
    ];
    // test with p == q
    let mut out = c.clone();
    unsafe {
        syscall_bls12381_fp_add(out.as_mut_ptr() as *mut u32, out.as_ptr() as *const u32);
    }
    assert_eq!(out, double);

    let mut out = a.clone();
    unsafe {
        syscall_bls12381_fp_add(out.as_mut_ptr() as *mut u32, b.as_ptr() as *const u32);
    }
    assert_eq!(out, add);

    println!("done");
}
